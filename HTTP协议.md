### HTTP协议

#### 1. HTTP协议用于客户端和服务端之间的通信

​		在HTTP通信过程中，请求访问文本或图像的一段为客户端，提供资源相应的一段被称为服务端。在两台计算机之间使用HTTP协议通信时，在一条通信线路上必有一端是客户端，另一端是服务端。

#### 2. 通过请求和响应的交换达成通信

​		HTTP协议规定，请求由客户端发出，最后服务器端响应请求并返回。也就是说，通信肯定是由客户端开始建立的，服务器端在接受到请求之前不会发送响应。

下面是从客户端发送给某个HTTP服务器的请求报文中的内容：

~~~html
	GET /index.htm HTTP/1.1
Host: hackr.jp
~~~

​		起始行开头的GET表示请求的类型，称为方法（method），随后的字符串 /index/htm指明了请求访问的资源对象，叫做请求URL。最后的 HTTP/1.1 即HTTP的版本号，提示客户端使用的HTTP协议功能。

这段话的意思是：请求访问某台HTTP服务器上的 /index.htm 页面资源。

接收到请求的服务器，将请求内容的处理结果以相应的形式返回。

以下是响应报文：

~~~html
HTTP/1.1 200 OK
Date: Tue, 10 Jul 2012 06:50:15 GMT
Content-Length: 362
Content-Type: text/html

<html>
...    
</html>
~~~

200 OK表示处理结果的状态码和原因短语，下一行显示了创建响应的日期时间。接着以一行分隔，之后的内容为资源实体的主体。

#### 3. HTTP是不保存状态的协议

​		HTTP协议自身不对请求和响应之间的通信状态进行保存，对于发送过的请求和响应都不做持久化处理。

​		HTTP协议的无保存性让它能够更快地处理大量事务。但是，随着Web的不断发展，因无状态而导致业务处理变得棘手的情况增多了，比如，用户登录到一家购物网站，即使他跳转到其他网站，也需要继续保持登录状态，为了实现保持状态功能，引入了Cookie技术。

#### 4. 请求URL定位资源

​		HTTP协议使用URL定位互联网上的资源。当客户端请求访问资源而发送请求时，URL需要将作为请求报文中的请求URL包含在内。

#### 5. 告知服务器意图的HTTP方法

下列为HTTP/1.1协议中可使用的方法：

* GET：获取资源

  GET方法用来请求访问已被URL识别的资源，指定的资源经服务器端解析后返回响应内容。也就是说，如果请求的资源是文本，那就保持原样返回；如果是想CGI（通用网关接口）那样的程序，则返回经过执行后的输出结果。

* POST：传输实体主体

  POST方法用来传输实体的主体。

  虽然GET方法也可以传输实体的主体，但一般不用GET方法传输，而是用POST方法。POST的主要目的不是获取响应的主体内容。

* PUT：传输文件

  PUT方法用来传输文件。要求在请求报文的主体中包含文件内容，然后保存到请求URL指定的位置。

  但是由于HTTP/1.1的PUT方法自身不带验证机制，任何人都可以上传文件，存在安全性问题，一般的网站不使用该方法。若配合Web应用程序的验证机制或架构设计采用REST标准的同类Web网站，就可能开放使用PUT方法。

* HEAD：获得报文首部

  HEAD方法和GET方法一样，只是不返回报文主体部分，用于确认URL的有效性及资源更新的日期时间等。

* DELETE：删除文件

  DELETE方法用来删除文件，是与PUT相反的方法。DELETE方法暗请求URL删除指定的资源。

  但是HTTP/1.1的DELETE方法本身跟PUT方法一样不带验证机制，若配合Web应用程序的验证机制或架构设计采用REST标准的同类Web网站，就可能开放使用DELETE方法。

* OPTIONS：询问支持的方法

  OPTIONS方法用来查询针对请求URL指定的资源支持的方法。

* TRACE：追踪路径

  TRACE方法是让Web服务器将之前的通信请求返回客户端的方法。

  客户端通过TRACE方法可以查询发送出去的请求是怎样被加工修改的。

  但是TRACE方法本身不常用，而且容易引发XST（跨站追踪）攻击，通常不会用到。

* CONNECT：要求用隧道协议连接代理

  CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL（安全套接层）和TLS（传输层安全）协议把通信内容加密后经网络隧道传输。

#### 6. 使用方法下达命令

向请求URL指定的资源发送请求报文时，采用称为方法的命令。下表列出HTTP/1.0和HTTP/1.1支持的方法：

![1632144518588](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1632144518588.png)

#### 7. 持久连接节省通信量

​		HTTP协议的初始版本中，每进行一次HTTP通信就要断开一次TCP连接。以当年的通信情况而言，因为都是些容量很小的文本传输，所以即使这样也没有多大问题，可随着HTTP的普及，文档中包含大量图片的情况多了起来。

​		在使用浏览器访问一个包含多张图片的HTML页面时，也会请求HTML页面包含的其他资源，因此，每次请求会造成无谓的TCP连接建立和断开，增加通信量的开销。

​		因此提出了持久连接的方法，其特点是：只要任意一段没有明确提出断开连接，则保持TCP的连接状态。这样做减少了TCP连接的重复建立和断开所造成的开销，减少服务期端的负担。

​		持久连接使得多数请求以管线化方式发送成为可能。从前发送请求后需等待并受到相应，才能发送下一个请求。管线化技术出现后，不用等待响应也可直接发送下一个请求。

#### 8. 使用cookie的状态管理

​		HTTP是无状态协议，它不对之前发生过的请求和响应的状态进行管理，也即无法根据之前的状态进行本次的请求处理。

​		为了保持客户端的状态，引入了Cookie技术。Cookie技术通过在请求和响应报文中写入Cookie信息来控制客户端的状态。

​		Cookie会根据从服务器端发送的响应报文中一个叫做set-Cookie的首部字段信息，通知客户端保存Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送出去。

​		服务器端发现客户端发送过来的Cookie后，会去检查究竟是从哪一个客户端发送来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。